var highScore=0,restart=0;$(window).load(runGame);function runGame(){function fa(){G();for(var a=0;a<h.length;a++)for(var k=0;k<h[a].length;k++){var l=k,p=a,e=h[a][k];e?(p*m>c.height&&5>e&&(h[p][l]=0,o--,0>=o&&(o="X",y()),H.play()),b.fillStyle=ga[e],b.fillRect(l*n,p*m,n,m),b.strokeRect(l*n+1,p*m+1,n-2,m-2)):b.clearRect(l*n,p*m,n,m)}z.beginPath();z.arc(f,g,d,0,2*Math.PI,!0);z.fillStyle=ha;z.fill();b.fillStyle=O;b.beginPath();a=0<ballDeltaX?d+5:-d-5;b.moveTo(f+a,g-d);b.lineTo(f+a,g+d);b.lineTo(f+a+ballDeltaX,g);b.lineTo(f+a,g-d);b.fill();b.closePath();b.fillStyle=O;b.beginPath();a=0<ballDeltaY?d+5:-d-5;"DOWN"==ballMoveUD?a=d+5:"UP"==ballMoveUD&&(a=-d-5);b.moveTo(f-d,g+a);b.lineTo(f,g+a+(0<a?Math.abs(ballDeltaY):-Math.abs(ballDeltaY)));b.lineTo(f+d,g+a);b.lineTo(f-d,g+a);b.fill();b.closePath();q=0;Math.abs(j+r/2-f)>r/3&&(q=j+r/2<f?2:-2);if(0>j+q||j+q+r>c.width)q=0;j+=q;b.fillStyle=P;b.fillRect(j,A,r,ia);b.fillStyle=P;b.font="12px 'Press Start 2P'";b.clearRect(0,c.height-30,c.width,30);b.fillText("SCORE:"+u,10,c.height-5);b.fillText("LEVEL:"+(v+1),c.width-100,c.height-5);b.fillText("BALLS:"+o,c.width/2-20,c.height-5);5E4<=u&&y(!0);a=g+ballDeltaY+d;k=g+ballDeltaY-d;l=f+ballDeltaX-d;p=f+ballDeltaX+d;a>=A&&(f+ballDeltaX>=j&&f+ballDeltaX<=j+r)&&(g=A,ballDeltaY=-Math.abs(ballDeltaY),w.play());"breakable"==Q()&&(ballDeltaY=0>ballDeltaY?ballDeltaY+20*R:ballDeltaY*x);"unbreakable"==Q()&&(ballDeltaY=-ballDeltaY*x,w.play());"breakable"==S()&&(ballDeltaX/=5);"unbreakable"==S()&&(ballDeltaX=-ballDeltaX*x,w.play());0>k&&(ballDeltaY=-ballDeltaY,w.play());a>c.height&&y();0>l||p>c.width?(ballDeltaX=-ballDeltaX,w.play()):("LEFT"==ballMoveLR&&ballDeltaX>-s&&(ballDeltaX-=T),"RIGHT"==ballMoveLR&&ballDeltaX<s&&(ballDeltaX+=T));a="DOWN"==ballMoveUD?0.25:0;k="UP"==ballMoveUD?-0.15:0;ballDeltaY>B&&(ballDeltaY=B);f+=ballDeltaX;g+=ballDeltaY;ballDeltaY=ballDeltaY+R+a+k;ballDeltaX=ballDeltaX>s?s:ballDeltaX;ballDeltaX=ballDeltaX<-s?-s:ballDeltaX;ballDeltaX*=x;ballDeltaX*=x;I++;I>ja&&(v++,o++,I=0,v==J.length&&y(!0));K++;if(K>J[v]){K=0;H.play();a=[];for(i=0;i<U;i++)k=0,l=100*Math.random(),96<l&&(k=5),85<l&&97>l&&(k=4),70<l&&86>l&&(k=3),40<l&&71>l&&(k=2),10<l&&41>l&&(k=1),a.push(k);h.unshift(a);50<h.length&&h.pop()}L>J[v]/12?(8<C&&(C=1),M[C].play(),C++,L=0):L++}function G(){b.clearRect(0,0,c.width,c.height)}function V(){restart?W():(b.fillStyle="rgb(235,235,235)",b.font="bold 21pt 'Press Start 2P'",b.fillText("OUTBREAK",c.width/2-e/2,c.height/2-100,e),b.font="bold 8pt 'Press Start 2P'",b.fillText("Revenge of the Ball",c.width/2-e/2,c.height/2-70,e),b.font="bold 11pt 'Press Start 2P'",b.fillText("Click to Start",c.width/2-e/2,c.height/2,e),b.fillText("use arrow keys",c.width/2-e/2,c.height/2+30,e),$("canvas").click(W))}function W(){$("canvas").unbind("click");$("canvas").css("cursor","none");G();ballDeltaY=-4;ballDeltaX=-2;ballMoveUD=ballMoveLR="NONE";q=0;gameLoop=setInterval(fa,20);$(document).keydown(function(a){a.preventDefault();a.keyCode==X?ballMoveLR="RIGHT":a.keyCode==Y&&(ballMoveLR="LEFT");a.keyCode==Z?ballMoveUD="UP":a.keyCode==aa&&(ballMoveUD="DOWN");a.keyCode==ba&&(B=40)});$(document).keyup(function(a){if(a.keyCode==Y&&"LEFT"==ballMoveLR||a.keyCode==X&&"RIGHT"==ballMoveLR)ballMoveLR="NONE";if(a.keyCode==Z||a.keyCode==aa)ballMoveUD="NONE";a.keyCode==ba&&(B=15)});ca&&($("#canvas").bind("touchstart",function(a){a.preventDefault();a=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];100>a.pageX-this.offsetLeft?ballMoveLR="LEFT":a.pageX-this.offsetLeft>c.width-100&&(ballMoveLR="RIGHT");a.pageY-this.offsetTop<c.height/2?ballMoveUD="UP":a.pageY-this.offsetTop>c.height/2&&(ballMoveUD="DOWN")}),$("#canvas").bind("touchend",function(){ballMoveUD=ballMoveLR="NONE"}))}function y(a){if(0<o&&"X"!=o)o--,f=c.width/2,g=c.height-300,ballDeltaY=ballDeltaX=0;else{var k="";u>highScore&&(highScore=u,k="New ");a=a?ka:la;clearInterval(gameLoop);$("canvas").click(runGame);$("canvas").css("cursor","default");restart=1;b.fillStyle="rgb(235,235,235)";b.font="bold 22px 'Press Start 2P'";b.fillText(a,c.width/2-e/2,c.height/2,e);b.font="bold 9pt 'Press Start 2P'";b.fillText(k+"High Score: "+highScore,c.width/2-e/2,c.height/2+50,e);b.fillText("click to restart",c.width/2-e/2,c.height/2+100,e)}}function S(){for(var a=!1,b=0;b<h.length;b++)for(var c=0;c<h[b].length;c++)if(h[b][c]){var e=c*n,j=b*m;if((f+ballDeltaX+d>=e&&f+d<=e||f+ballDeltaX-d<=e+n&&f-d>=e+n)&&g+ballDeltaY-d<=j+m&&g+ballDeltaY+d>=j)5>h[b][c]?(da(b,c),a="breakable"):a="unbreakable"}return a}function Q(){for(var a=!1,b=0;b<h.length;b++)for(var c=0;c<h[b].length;c++)if(h[b][c]){var e=c*n,j=b*m;if((g+ballDeltaY-d<=j+m&&g-d>=j+m||g+ballDeltaY+d>=j&&g+d<=j||g+ballDeltaY-d>=j&&g+d<=j)&&f+ballDeltaX+d>=e&&f+ballDeltaX-d<=e+n)5>h[b][c]?(da(b,c),a="breakable"):a="unbreakable"}return a}function da(a,b){0<h[a][b]&&u++;5>h[a][b]&&h[a][b]--;0==h[a][b]?(D[E].play(),E++,E>=D.length&&(E=0)):(N[F].play(),F++,F>=N.length&&(F=0))}var c=document.getElementById("canvas"),b=c.getContext("2d"),z=c.getContext("2d");G();var K=0,L=0,la="GAME OVER",ka="YOU WIN",e=200,I=0,ja=1700,o=4,X=39,Y=37,Z=38,aa=40,ba=32,j=200,A=500,r=80,ia=20,q=0,T=0.4,s=8,B=15,x=0.97,f=300,g=300,d=6,R=0.12,N=[],t=html5Preloader();for(i=0;3>i;i++)N[i]=new Audio("hit.wav");var D=[];for(i=0;3>i;i++)D[i]=new Audio("break.wav"),D[i].volume=0.6;var w=new Audio("bounce.wav"),H=new Audio("newbricks.wav");H.volume=0.6;t.addFiles("hit.wav","break.wav","bounce.wav","newbricks.wav");var M=[];for(i=1;9>i;i++)M[i]=new Audio("song/note"+i+".wav"),t.addFiles("song/note"+i+".wav"),M[i].volume=0.4;var C=1,F=0,E=0,ha="rgb(168,219,168)",O="rgba(121,189,154,.3)",P="rgb(121,189,154)",ga={1:"rgba(59,134,134,.2)",2:"rgba(59,134,134,.5)",3:"rgba(59,134,134,.8)",4:"rgba(59,134,134,1)",5:"silver"},v=0,J=[500,400,300,200,160,140,120,100,80,50],U=12,m=16,n=c.width/U,h=[[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,2,3,3,3,3,3,3,2,3,3],[3,3,3,2,2,3,3,2,2,3,3,3],[3,3,3,5,3,2,2,3,5,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,2,3,3,2,3,3,3,3],[3,3,3,3,3,2,2,3,3,3,3,3],[3,3,3,3,1,1,1,1,3,3,3,3],[3,3,3,1,1,1,1,1,1,3,3,3],[3,2,1,1,1,1,1,1,1,1,2,3]],u=0,ca=0,t=window,ma=t.innerWidth,ea=t.innerHeight;t.navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/i)&&(ca=1,c.height=ea,c.width=ma,setTimeout(V,200),A=ea-60);V()};