var highScore=0,restart=0;$(window).load(runGame); function runGame(){function ga(){G();for(var a=0;a<g.length;a++)for(var h=0;h<g[a].length;h++){var j=h,k=a,l=g[a][h];l?(k*m>c.height&&5>l&&(v=0,H()),b.fillStyle=ha[l],b.fillRect(j*o,k*m,o,m),b.strokeRect(j*o+1,k*m+1,o-2,m-2)):b.clearRect(j*o,k*m,o,m)}z.beginPath();z.arc(e,f,d,0,2*Math.PI,!0);z.fillStyle=ia;z.fill();b.fillStyle=O;b.beginPath();a=0<ballDeltaX?d+5:-d-5;b.moveTo(e+a,f-d);b.lineTo(e+a,f+d);b.lineTo(e+a+ballDeltaX,f);b.lineTo(e+a,f-d);b.fill();b.closePath();b.fillStyle=O;b.beginPath(); a=0<ballDeltaY?d+5:-d-5;"DOWN"==ballMoveUD?a=d+5:"UP"==ballMoveUD&&(a=-d-5);b.moveTo(e-d,f+a);b.lineTo(e,f+a+(0<a?Math.abs(ballDeltaY):-Math.abs(ballDeltaY)));b.lineTo(e+d,f+a);b.lineTo(e-d,f+a);b.fill();b.closePath();q=0;Math.abs(p+r/2-e)>r/3&&(q=p+r/2<e?2:-2);if(0>p+q||p+q+r>c.width)q=0;p+=q;b.fillStyle=P;b.fillRect(p,A,r,ja);b.fillStyle=P;b.font="12px 'Press Start 2P'";b.clearRect(0,c.height-30,c.width,30);b.fillText("SCORE:"+w,10,c.height-5);b.fillText("LEVEL:"+(s+1),c.width-100,c.height-5);b.fillText("BALLS:"+ v,c.width/2-20,c.height-5);5E4<=w&&H(!0);a=f+ballDeltaY+d;h=f+ballDeltaY-d;j=e+ballDeltaX-d;k=e+ballDeltaX+d;a>=A&&(e+ballDeltaX>=p&&e+ballDeltaX<=p+r)&&(f=A,ballDeltaY=-ballDeltaY,x.play());"breakable"==Q()&&(ballDeltaY=0>ballDeltaY?ballDeltaY+20*R:ballDeltaY*y);"unbreakable"==Q()&&(ballDeltaY=-ballDeltaY*y,x.play());"breakable"==S()&&(ballDeltaX/=5);"unbreakable"==S()&&(ballDeltaX=-ballDeltaX*y,x.play());0>h&&(ballDeltaY=-ballDeltaY,x.play());a>c.height&&H();0>j||k>c.width?(ballDeltaX=-ballDeltaX, x.play()):("LEFT"==ballMoveLR&&ballDeltaX>-t&&(ballDeltaX-=T),"RIGHT"==ballMoveLR&&ballDeltaX<t&&(ballDeltaX+=T));a="DOWN"==ballMoveUD?0.25:0;h="UP"==ballMoveUD?-0.15:0;ballDeltaY>B&&(ballDeltaY=B);e+=ballDeltaX;f+=ballDeltaY;ballDeltaY=ballDeltaY+R+a+h;ballDeltaX=ballDeltaX>t?t:ballDeltaX;ballDeltaX=ballDeltaX<-t?-t:ballDeltaX;ballDeltaX*=y;ballDeltaX*=y;I++;I>ka&&(s++,v++,I=0,s==J.length&&s--);K++;if(K>J[s]){K=0;U.play();a=[];for(i=0;i<V;i++)h=0,j=100*Math.random(),96<j&&(h=5),85<j&&97>j&&(h=4), 70<j&&86>j&&(h=3),40<j&&71>j&&(h=2),10<j&&41>j&&(h=1),a.push(h);g.unshift(a);50<g.length&&g.pop()}L>J[s]/12?(8<C&&(C=1),M[C].play(),C++,L=0):L++}function G(){b.clearRect(0,0,c.width,c.height)}function W(){restart?X():(b.fillStyle="rgb(235,235,235)",b.font="bold 28pt 'Press Start 2P'",b.fillText("OUTBREAK",c.width/2-n/2,c.height/2-100,n),b.font="bold 18pt 'Press Start 2P'",b.fillText("Click to Start",c.width/2-n/2,c.height/2,n),b.fillText("use arrow keys",c.width/2-n/2,c.height/2+30,n),$("canvas").click(X))} function X(){$("canvas").unbind("click");$("canvas").css("cursor","none");G();ballDeltaY=-4;ballDeltaX=-2;ballMoveUD=ballMoveLR="NONE";q=0;gameLoop=setInterval(ga,20);$(document).keydown(function(a){a.preventDefault();a.keyCode==Y?ballMoveLR="RIGHT":a.keyCode==Z&&(ballMoveLR="LEFT");a.keyCode==aa?ballMoveUD="UP":a.keyCode==ba&&(ballMoveUD="DOWN");a.keyCode==ca&&(B=40)});$(document).keyup(function(a){if(a.keyCode==Z&&"LEFT"==ballMoveLR||a.keyCode==Y&&"RIGHT"==ballMoveLR)ballMoveLR="NONE";if(a.keyCode== aa||a.keyCode==ba)ballMoveUD="NONE";a.keyCode==ca&&(B=15)});da&&($("#canvas").bind("touchstart",function(a){a.preventDefault();a=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];100>a.pageX-this.offsetLeft?ballMoveLR="LEFT":a.pageX-this.offsetLeft>c.width-100&&(ballMoveLR="RIGHT");a.pageY-this.offsetTop<c.height/2?ballMoveUD="UP":a.pageY-this.offsetTop>c.height/2&&(ballMoveUD="DOWN")}),$("#canvas").bind("touchend",function(){ballMoveUD=ballMoveLR="NONE"}))}function H(a){if(0<v)v--,e= c.width/2,f=c.height-300,ballDeltaY=ballDeltaX=0;else{var h="";w>highScore&&(highScore=w,h="New ");a=a?la:ma;clearInterval(gameLoop);$("canvas").click(runGame);$("canvas").css("cursor","default");restart=1;b.fillStyle="rgb(235,235,235)";b.font="bold 22px 'Press Start 2P'";b.fillText(a,c.width/2-n/2,c.height/2,n);b.font="bold 10pt 'Press Start 2P'";b.fillText(h+"High Score: "+highScore,c.width/2-n/2,c.height/2+50,n);b.fillText("click to restart",c.width/2-n/2,c.height/2+100,n)}}function S(){for(var a= !1,b=0;b<g.length;b++)for(var c=0;c<g[b].length;c++)if(g[b][c]){var k=c*o,l=b*m;if((e+ballDeltaX+d>=k&&e+d<=k||e+ballDeltaX-d<=k+o&&e-d>=k+o)&&f+ballDeltaY-d<=l+m&&f+ballDeltaY+d>=l)5>g[b][c]?(ea(b,c),a="breakable"):a="unbreakable"}return a}function Q(){for(var a=!1,b=0;b<g.length;b++)for(var c=0;c<g[b].length;c++)if(g[b][c]){var k=c*o,l=b*m;if((f+ballDeltaY-d<=l+m&&f-d>=l+m||f+ballDeltaY+d>=l&&f+d<=l||f+ballDeltaY-d>=l&&f+d<=l)&&e+ballDeltaX+d>=k&&e+ballDeltaX-d<=k+o)5>g[b][c]?(ea(b,c),a="breakable"): a="unbreakable"}return a}function ea(a,b){0<g[a][b]&&w++;5>g[a][b]&&g[a][b]--;0==g[a][b]?(D[E].play(),E++,E>=D.length&&(E=0)):(N[F].play(),F++,F>=N.length&&(F=0))}var c=document.getElementById("canvas"),b=c.getContext("2d"),z=c.getContext("2d");G();var K=0,L=0,ma="GAME OVER",la="YOU WIN",n=200,I=0,ka=1700,v=4,Y=39,Z=37,aa=38,ba=40,ca=32,p=200,A=500,r=80,ja=20,q=0,T=0.4,t=8,B=15,y=0.97,e=300,f=300,d=6,R=0.12,N=[],u=html5Preloader();for(i=0;3>i;i++)N[i]=new Audio("hit.wav");var D=[];for(i=0;3>i;i++)D[i]= new Audio("break.wav"),D[i].volume=0.6;var x=new Audio("bounce.wav"),U=new Audio("newbricks.wav");U.volume=0.6;u.addFiles("hit.wav","break.wav","bounce.wav","newbricks.wav");var M=[];for(i=1;9>i;i++)M[i]=new Audio("song/note"+i+".wav"),u.addFiles("song/note"+i+".wav"),M[i].volume=0.4;var C=1,F=0,E=0,ia="rgb(168,219,168)",O="rgba(121,189,154,.3)",P="rgb(121,189,154)",ha={1:"rgba(59,134,134,.2)",2:"rgba(59,134,134,.5)",3:"rgba(59,134,134,.8)",4:"rgba(59,134,134,1)",5:"silver"},s=0,J=[500,400,300,200, 100,75,60,40,30,20],V=12,m=16,o=c.width/V,g=[[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,2,3,3,3,3,3,3,2,3,3],[3,3,3,2,2,3,3,2,2,3,3,3],[3,3,3,5,3,2,2,3,5,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,2,3,3,2,3,3,3,3],[3,3,3,3,3,2,2,3,3,3,3,3],[3,3,3,3,1,1,1,1,3,3,3,3],[3,3,3,1,1,1,1,1,1,3,3,3],[3,2,1,1,1,1,1,1,1,1,2,3]],w=0,da=0,u=window,na=u.innerWidth,fa=u.innerHeight;u.navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/i)&&(da=1,c.height=fa,c.width=na,setTimeout(W,200), A=fa-60);W()};