var highScore=0,restart=0;$(window).load(runGame); function runGame(){function fa(){F();for(var a=0;a<h.length;a++)for(var j=0;j<h[a].length;j++){var k=j,e=a,l=h[a][j];l?(e*m>c.height&&5>l&&(u=0,G()),b.fillStyle=ga[l],b.fillRect(k*n,e*m,n,m),b.strokeRect(k*n+1,e*m+1,n-2,m-2)):b.clearRect(k*n,e*m,n,m)}y.beginPath();y.arc(f,g,d,0,2*Math.PI,!0);y.fillStyle=ha;y.fill();b.fillStyle=N;b.beginPath();a=0<ballDeltaX?d+5:-d-5;b.moveTo(f+a,g-d);b.lineTo(f+a,g+d);b.lineTo(f+a+ballDeltaX,g);b.lineTo(f+a,g-d);b.fill();b.closePath();b.fillStyle=N;b.beginPath(); a=0<ballDeltaY?d+5:-d-5;"DOWN"==ballMoveUD?a=d+5:"UP"==ballMoveUD&&(a=-d-5);b.moveTo(f-d,g+a);b.lineTo(f,g+a+(0<a?Math.abs(ballDeltaY):-Math.abs(ballDeltaY)));b.lineTo(f+d,g+a);b.lineTo(f-d,g+a);b.fill();b.closePath();p=0;Math.abs(o+q/2-f)>q/3&&(p=o+q/2<f?2:-2);if(0>o+p||o+p+q>c.width)p=0;o+=p;b.fillStyle=O;b.fillRect(o,z,q,ia);b.fillStyle=O;b.font="12px 'Press Start 2P'";b.clearRect(0,c.height-30,c.width,30);b.fillText("SCORE:"+v,10,c.height-5);b.fillText("LEVEL:"+(r+1),c.width-100,c.height-5);b.fillText("BALLS:"+ u,c.width/2-20,c.height-5);5E4<=v&&G(!0);a=g+ballDeltaY+d;j=g+ballDeltaY-d;k=f+ballDeltaX-d;e=f+ballDeltaX+d;a>=z&&(f+ballDeltaX>=o&&f+ballDeltaX<=o+q)&&(g=z,ballDeltaY=-ballDeltaY,w.play());"breakable"==P()&&(ballDeltaY=0>ballDeltaY?ballDeltaY+20*Q:ballDeltaY*x);"unbreakable"==P()&&(ballDeltaY=-ballDeltaY*x,w.play());"breakable"==R()&&(ballDeltaX/=5);"unbreakable"==R()&&(ballDeltaX=-ballDeltaX*x,w.play());0>j&&(ballDeltaY=-ballDeltaY,w.play());a>c.height&&G();0>k||e>c.width?(ballDeltaX=-ballDeltaX, w.play()):("LEFT"==ballMoveLR&&ballDeltaX>-s&&(ballDeltaX-=S),"RIGHT"==ballMoveLR&&ballDeltaX<s&&(ballDeltaX+=S));a="DOWN"==ballMoveUD?0.25:0;j="UP"==ballMoveUD?-0.15:0;ballDeltaY>A&&(ballDeltaY=A);f+=ballDeltaX;g+=ballDeltaY;ballDeltaY=ballDeltaY+Q+a+j;ballDeltaX=ballDeltaX>s?s:ballDeltaX;ballDeltaX=ballDeltaX<-s?-s:ballDeltaX;ballDeltaX*=x;ballDeltaX*=x;H++;H>ja&&(r++,u++,H=0,r==I.length&&r--);J++;if(J>I[r]){J=0;T.play();a=[];for(i=0;i<U;i++)j=0,k=100*Math.random(),96<k&&(j=5),85<k&&97>k&&(j=4), 70<k&&86>k&&(j=3),40<k&&71>k&&(j=2),10<k&&41>k&&(j=1),a.push(j);h.unshift(a);50<h.length&&h.pop()}K>I[r]/12?(8<B&&(B=1),L[B].play(),B++,K=0):K++}function F(){b.clearRect(0,0,c.width,c.height)}function V(){restart?W():(b.fillStyle="rgb(235,235,235)",b.font="bold 28pt 'Press Start 2P'",b.fillText("OUTBREAK",c.width/2-e/2,c.height/2-100,e),b.font="bold 10pt 'Press Start 2P'",b.fillText("Revenge of the Ball",c.width/2-e/2,c.height/2-70,e),b.font="bold 18pt 'Press Start 2P'",b.fillText("Click to Start", c.width/2-e/2,c.height/2,e),b.fillText("use arrow keys",c.width/2-e/2,c.height/2+30,e),$("canvas").click(W))}function W(){$("canvas").unbind("click");$("canvas").css("cursor","none");F();ballDeltaY=-4;ballDeltaX=-2;ballMoveUD=ballMoveLR="NONE";p=0;gameLoop=setInterval(fa,20);$(document).keydown(function(a){a.preventDefault();a.keyCode==X?ballMoveLR="RIGHT":a.keyCode==Y&&(ballMoveLR="LEFT");a.keyCode==Z?ballMoveUD="UP":a.keyCode==aa&&(ballMoveUD="DOWN");a.keyCode==ba&&(A=40)});$(document).keyup(function(a){if(a.keyCode== Y&&"LEFT"==ballMoveLR||a.keyCode==X&&"RIGHT"==ballMoveLR)ballMoveLR="NONE";if(a.keyCode==Z||a.keyCode==aa)ballMoveUD="NONE";a.keyCode==ba&&(A=15)});ca&&($("#canvas").bind("touchstart",function(a){a.preventDefault();a=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];100>a.pageX-this.offsetLeft?ballMoveLR="LEFT":a.pageX-this.offsetLeft>c.width-100&&(ballMoveLR="RIGHT");a.pageY-this.offsetTop<c.height/2?ballMoveUD="UP":a.pageY-this.offsetTop>c.height/2&&(ballMoveUD="DOWN")}),$("#canvas").bind("touchend", function(){ballMoveUD=ballMoveLR="NONE"}))}function G(a){if(0<u)u--,f=c.width/2,g=c.height-300,ballDeltaY=ballDeltaX=0;else{var j="";v>highScore&&(highScore=v,j="New ");a=a?ka:la;clearInterval(gameLoop);$("canvas").click(runGame);$("canvas").css("cursor","default");restart=1;b.fillStyle="rgb(235,235,235)";b.font="bold 22px 'Press Start 2P'";b.fillText(a,c.width/2-e/2,c.height/2,e);b.font="bold 10pt 'Press Start 2P'";b.fillText(j+"High Score: "+highScore,c.width/2-e/2,c.height/2+50,e);b.fillText("click to restart", c.width/2-e/2,c.height/2+100,e)}}function R(){for(var a=!1,b=0;b<h.length;b++)for(var c=0;c<h[b].length;c++)if(h[b][c]){var e=c*n,l=b*m;if((f+ballDeltaX+d>=e&&f+d<=e||f+ballDeltaX-d<=e+n&&f-d>=e+n)&&g+ballDeltaY-d<=l+m&&g+ballDeltaY+d>=l)5>h[b][c]?(da(b,c),a="breakable"):a="unbreakable"}return a}function P(){for(var a=!1,b=0;b<h.length;b++)for(var c=0;c<h[b].length;c++)if(h[b][c]){var e=c*n,l=b*m;if((g+ballDeltaY-d<=l+m&&g-d>=l+m||g+ballDeltaY+d>=l&&g+d<=l||g+ballDeltaY-d>=l&&g+d<=l)&&f+ballDeltaX+ d>=e&&f+ballDeltaX-d<=e+n)5>h[b][c]?(da(b,c),a="breakable"):a="unbreakable"}return a}function da(a,b){0<h[a][b]&&v++;5>h[a][b]&&h[a][b]--;0==h[a][b]?(C[D].play(),D++,D>=C.length&&(D=0)):(M[E].play(),E++,E>=M.length&&(E=0))}var c=document.getElementById("canvas"),b=c.getContext("2d"),y=c.getContext("2d");F();var J=0,K=0,la="GAME OVER",ka="YOU WIN",e=200,H=0,ja=1700,u=4,X=39,Y=37,Z=38,aa=40,ba=32,o=200,z=500,q=80,ia=20,p=0,S=0.4,s=8,A=15,x=0.97,f=300,g=300,d=6,Q=0.12,M=[],t=html5Preloader();for(i=0;3> i;i++)M[i]=new Audio("hit.wav");var C=[];for(i=0;3>i;i++)C[i]=new Audio("break.wav"),C[i].volume=0.6;var w=new Audio("bounce.wav"),T=new Audio("newbricks.wav");T.volume=0.6;t.addFiles("hit.wav","break.wav","bounce.wav","newbricks.wav");var L=[];for(i=1;9>i;i++)L[i]=new Audio("song/note"+i+".wav"),t.addFiles("song/note"+i+".wav"),L[i].volume=0.4;var B=1,E=0,D=0,ha="rgb(168,219,168)",N="rgba(121,189,154,.3)",O="rgb(121,189,154)",ga={1:"rgba(59,134,134,.2)",2:"rgba(59,134,134,.5)",3:"rgba(59,134,134,.8)", 4:"rgba(59,134,134,1)",5:"silver"},r=0,I=[500,400,300,200,100,75,60,40,30,20],U=12,m=16,n=c.width/U,h=[[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,2,3,3,3,3,3,3,2,3,3],[3,3,3,2,2,3,3,2,2,3,3,3],[3,3,3,5,3,2,2,3,5,3,3,3],[3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,2,3,3,2,3,3,3,3],[3,3,3,3,3,2,2,3,3,3,3,3],[3,3,3,3,1,1,1,1,3,3,3,3],[3,3,3,1,1,1,1,1,1,3,3,3],[3,2,1,1,1,1,1,1,1,1,2,3]],v=0,ca=0,t=window,ma=t.innerWidth,ea=t.innerHeight;t.navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/i)&& (ca=1,c.height=ea,c.width=ma,setTimeout(V,200),z=ea-60);V()};